-- COMPANIA
CREATE TABLE COMPANIA (
    cif VARCHAR2(9),
    nombre VARCHAR2(50) NOT NULL,
    direccion VARCHAR2(100),
    telefono VARCHAR2(50)
);
ALTER TABLE COMPANIA ADD CONSTRAINT PK_COMPANIA_CIF PRIMARY KEY (cif);
ALTER TABLE COMPANIA ADD CONSTRAINT UK_COMPANIA_NOMBRE UNIQUE (nombre);

-- COMPRA_PARTICULAR
CREATE TABLE COMPRA_PARTICULAR (
    id NUMBER,
    compania VARCHAR2(9),
    fecha VARCHAR2(50),
    firma VARCHAR2(50)
);
ALTER TABLE COMPRA_PARTICULAR ADD CONSTRAINT PK_COMPRA_PARTICULAR_ID PRIMARY KEY (id);
ALTER TABLE COMPRA_PARTICULAR ADD CONSTRAINT FK_COMPRA_PARTICULAR_COMPANIA FOREIGN KEY (compania) REFERENCES COMPANIA (cif);

-- PARTICULAR
CREATE TABLE PARTICULAR (
    id NUMBER,
    dni VARCHAR2(9),
    nombre VARCHAR2(50) NOT NULL,
    telefono VARCHAR2(50),
    direccion VARCHAR2(50)
);
ALTER TABLE PARTICULAR ADD CONSTRAINT PK_PARTICULAR_ID PRIMARY KEY (id);
ALTER TABLE PARTICULAR ADD CONSTRAINT UK_PARTICULAR_DNI UNIQUE (dni);

-- JUGUETE_PARTICULAR
CREATE TABLE JUGUETE_PARTICULAR (
    id NUMBER,
    id_particular NUMBER,
    nombre NUMBER NOT NULL,
    stock NUMBER DEFAULT (0),
    precio NUMBER(9,2) NOT NULL,
    coste NUMBER(9,2) NOT NULL
);
ALTER TABLE JUGUETE_PARTICULAR ADD CONSTRAINT PK_JUGUETE_PARTICULAR_ID PRIMARY KEY (id);
ALTER TABLE JUGUETE_PARTICULAR ADD CONSTRAINT FK_JUGUETE_PARTICULAR_ID FOREIGN KEY (id_particular) REFERENCES PARTICULAR (id);

-- COMPRA_PARTICULAR_JUGUETE
CREATE TABLE COMPRA_PARTICULAR_JUGUETE (
    id_compra NUMBER,
    id_juguete NUMBER,
    unidades NUMBER
);
ALTER TABLE COMPRA_PARTICULAR_JUGUETE ADD CONSTRAINT FK_COMPRA_PARTICULAR_JUGUETE_ID_COMPRA FOREIGN KEY (id_compra) REFERENCES COMPRA_PARTICULAR (id);
ALTER TABLE COMPRA_PARTICULAR_JUGUETE ADD CONSTRAINT FK_COMPRA_PARTICULAR_JUGUETE_ID_JUGUETE FOREIGN KEY (id_juguete) REFERENCES JUGUETE_PARTICULAR (id);

-- RECEPCION_PARTICULAR
CREATE TABLE RECEPCION_PARTICULAR (
    id NUMBER,
    id_compra NUMBER,
    fecha VARCHAR2(50),
    estado VARCHAR2(10),
    incidencia VARCHAR2(100)
);
ALTER TABLE RECEPCION_PARTICULAR ADD CONSTRAINT PK_RECEPCION_PARTICULAR_ID PRIMARY KEY (id);
ALTER TABLE RECEPCION_PARTICULAR ADD CONSTRAINT FK_RECEPCION_PARTICULAR_ID_COMPRA FOREIGN KEY (id_compra) REFERENCES COMPRA_PARTICULAR (id);
ALTER TABLE RECEPCION_PARTICULAR ADD CONSTRAINT CK_RECEPCION_PARTICULAR_ESTADO CHECK (estado IN ('Completo', 'Incompleto', 'Devuleto', 'Otro'));

-- COMPRA_EMPRESA
CREATE TABLE COMPRA_EMPRESA (
    id NUMBER,
    compania VARCHAR2(9),
    fecha VARCHAR2(50),
    firma VARCHAR2(50)
);
ALTER TABLE COMPRA_EMPRESA ADD CONSTRAINT PK_COMPRA_EMPRESA_ID PRIMARY KEY (id);
ALTER TABLE COMPRA_EMPRESA ADD CONSTRAINT FK_COMPRA_EMPRESA_COMPANIA FOREIGN KEY (compania) REFERENCES COMPANIA (cif);

-- EMPRESA
CREATE TABLE EMPRESA (
    id NUMBER,
    cif VARCHAR2(9),
    nombre VARCHAR2(50) NOT NULL,
    telefono VARCHAR2(50),
    web VARCHAR2(100),
    direccion VARCHAR2(50),
    responsable VARCHAR2(50)
);
ALTER TABLE EMPRESA ADD CONSTRAINT PK_EMPRESA_ID PRIMARY KEY (id);
ALTER TABLE EMPRESA ADD CONSTRAINT UK_EMPRESA_CIF UNIQUE (cif);

-- JUGUETE_EMPRESA
CREATE TABLE JUGUETE_EMPRESA (
    id NUMBER,
    id_empresa NUMBER,
    nombre NUMBER NOT NULL,
    stock NUMBER DEFAULT (0),
    precio NUMBER(9,2) NOT NULL,
    coste NUMBER(9,2) NOT NULL
);
ALTER TABLE JUGUETE_EMPRESA ADD CONSTRAINT PK_JUGUETE_EMPRESA_ID PRIMARY KEY (id);
ALTER TABLE JUGUETE_EMPRESA ADD CONSTRAINT FK_JUGUETE_EMPRESA_ID FOREIGN KEY (id_empresa) REFERENCES EMPRESA (id);

-- COMPRA_EMPRESA_JUGUETE
CREATE TABLE COMPRA_EMPRESA_JUGUETE (
    id_compra NUMBER,
    id_juguete NUMBER,
    unidades NUMBER
);
ALTER TABLE COMPRA_EMPRESA_JUGUETE ADD CONSTRAINT FK_COMPRA_EMPRESA_JUGUETE_ID_COMPRA FOREIGN KEY (id_compra) REFERENCES COMPRA_EMPRESA (id);
ALTER TABLE COMPRA_EMPRESA_JUGUETE ADD CONSTRAINT FK_COMPRA_EMPRESA_JUGUETE_ID_JUGUETE FOREIGN KEY (id_juguete) REFERENCES JUGUETE_EMPRESA (id);

-- RECEPCION_EMPRESA
CREATE TABLE RECEPCION_EMPRESA (
    id NUMBER,
    id_compra NUMBER,
    fecha VARCHAR2(50),
    estado VARCHAR2(10),
    incidencia VARCHAR2(100)
);
ALTER TABLE RECEPCION_EMPRESA ADD CONSTRAINT PK_RECEPCION_EMPRESA_ID PRIMARY KEY (id);
ALTER TABLE RECEPCION_EMPRESA ADD CONSTRAINT FK_RECEPCION_EMPRESA_ID_COMPRA FOREIGN KEY (id_compra) REFERENCES COMPRA_EMPRESA (id);
ALTER TABLE RECEPCION_EMPRESA ADD CONSTRAINT CK_RECEPCION_EMPRESA_ESTADO CHECK (estado IN ('Completo', 'Incompleto', 'Devuleto', 'Otro'));

-- SEGUNDA PARTE
-- CLIENTE
CREATE TABLE CLIENTE (
    id NUMBER,
    dni VARCHAR2(9),
    nombre VARCHAR2(50) NOT NULL,
    email VARCHAR2(50),
    usuario VARCHAR2(50) NOT NULL,
    clave VARCHAR2(255) NOT NULL
);
ALTER TABLE CLIENTE ADD CONSTRAINT PK_CLIENTE_ID PRIMARY KEY (id);
ALTER TABLE CLIENTE ADD CONSTRAINT UK_CLIENTE_DNI UNIQUE (dni);
ALTER TABLE CLIENTE ADD CONSTRAINT UK_CLIENTE_USUARIO UNIQUE (usuario);

-- DIRECCION
CREATE TABLE DIRECCION (
    id NUMBER,
    calle VARCHAR2(50),
    piso NUMBER,
    portal NUMBER,
    observaciones VARCHAR2(255)
);
ALTER TABLE DIRECCION ADD CONSTRAINT PK_DIRECCION_ID PRIMARY KEY (id);

-- DIRECCION_CLIENTE
CREATE TABLE DIRECCION_CLIENTE (
    id_direccion NUMBER,
    id_cliente NUMBER
);
ALTER TABLE DIRECCION_CLIENTE ADD CONSTRAINT FK_DIRECCION_CLIENTE_ID_DIRECCION FOREIGN KEY (id_direccion) REFERENCES DIRECCION (id);
ALTER TABLE DIRECCION_CLIENTE ADD CONSTRAINT FK_DIRECCION_CLIENTE_ID_CLIENTE FOREIGN KEY (id_cliente) REFERENCES CLIENTE (id);

--  FACTURACION
CREATE TABLE FACTURACION (
    id NUMBER,
    cif VARCHAR2(9),
    razon_social VARCHAR(255) NOT NULL,
    telefono VARCHAR2(50),
    pais VARCHAR2(50)
);
ALTER TABLE FACTURACION ADD CONSTRAINT PK_FACTURACION_ID PRIMARY KEY (id);
ALTER TABLE FACTURACION ADD CONSTRAINT UK_FACTURACION_CIF UNIQUE (cif);

-- FACTURACION_CLIENTE
CREATE TABLE FACTURACION_CLIENTE (
    id_facturacion NUMBER,
    id_cliente NUMBER
);
ALTER TABLE FACTURACION_CLIENTE ADD CONSTRAINT FK_FACTURACION_CLIENTE_ID_FACTURACION FOREIGN KEY (id_facturacion) REFERENCES FACTURACION (id);
ALTER TABLE FACTURACION_CLIENTE ADD CONSTRAINT FK_FACTURACION_CLIENTE_ID_CLIENTE FOREIGN KEY (id_cliente) REFERENCES CLIENTE (id);

-- VENTA
CREATE TABLE VENTA (
    id NUMBER,
    id_cliente NUMBER,
    envio VARCHAR(200),
    facturacion VARCHAR(200) NOT NULL,
    fecha VARCHAR(200),
    metodo VARCHAR(200) NOT NULL,
    comp_envio VARCHAR(200),
    tipo_tarjeta VARCHAR(200),
    codigo_envio VARCHAR(50),
    num_tarjeta VARCHAR(12),
    gastos_envio VARCHAR(100)
);
ALTER TABLE VENTA ADD CONSTRAINT PK_VENTA_ID PRIMARY KEY (id);
ALTER TABLE VENTA ADD CONSTRAINT FK_VENTA_ID_CLIENTE FOREING KEY (id_cliente) REFERENCES CLIENTE (id);
ALTER TABLE VENTA ADD CONSTRAINT CK_VENTA_METODO CHECK (metodo IN ('Efectivo', 'Online', 'Otro'));

-- DEVOLUCION
CREATE TABLE DEVOLUCION (
    id NUMBER,
    juguete_id NUMBER,
    unidades NUMBER,
    fecha VARCHAR(100)
);
ALTER TABLE DEVOLUCION ADD CONSTRAINT PK_DEVOLUCION_ID PRIMARY KEY (id);

-- FACTURACION
CREATE TABLE FACTURACION (
    id NUMBER,
    id_cliente NUMBER,
    razon_social VARCHAR(100),
    cif VARCHAR(10),
    telefono VARCHAR(9),
    pais VARCHAR(100)
);
ALTER TABLE FACTURACION ADD CONSTRAINT PK_FACTURACION_ID PRIMARY KEY (id);
ALTER TABLE FACTURACION ADD CONSTRAINT FK_FACTURACION_ID_CLIENTE REFERENCES CLIENTE (id);

-- VENTA_JUGUETE_PARTICULAR
CREATE TABLE VENTA_JUGUETE_PARTICULAR (
    id NUMBER,
    unidades NUMBER,
    id_juguete NUMBER
);
ALTER TABLE VENTA_JUGUETE_PARTICULAR ADD CONSTRAINT PK_VENTA_JUGUETE_PARTICULAR_ID PRIMARY KEY (id);
ALTER TABLE VENTA_JUGUETE_PARTICULAR ADD CONSTRAINT FK_VENTA_JUGUETE_PARTICULAR_ID_JUGUETE FOREIGN KEY (id_juguete) REFERENCES JUGUETE_PARTICULAR (id);

-- VENTA_EMPRESA_PARTICULAR
CREATE TABLE VENTA_EMPRESA_PARTICULAR (
    id NUMBER,
    unidades NUMBER,
    id_juguete NUMBER
);
ALTER TABLE VENTA_EMPRESA_PARTICULAR ADD CONSTRAINT PK_VENTA_EMPRESA_PARTICULAR_ID PRIMARY KEY (id);
ALTER TABLE VENTA_EMPRESA_PARTICULAR ADD CONSTRAINT FK_VENTA_EMPRESA_PARTICULAR_ID_JUGUETE FOREIGN KEY (id_juguete) REFERENCES JUGUETE_EMPRESA (id);

-- RESERVA_PARTICULAR
CREATE TABLE RESERVA_PARTICULAR (
    id NUMBER,
    unidades NUMBER,
    id_juguete NUMBER
);
ALTER TABLE RESERVA_PARTICULAR ADD CONSTRAINT PK_RESERVA_PARTICULAR_ID PRIMARY KEY (id);
ALTER TABLE RESERVA_PARTICULAR ADD CONSTRAINT PK_RESERVA_PARTICULAR_ID_JUGUETE FOREIGN KEY (id_juguete) REFERENCES JUGUETE_PARTICULAR (id);

-- RESERVA_EMPRESA
CREATE TABLE RESERVA_EMPRESA (
    id NUMBER,
    unidades NUMBER,
    id_juguete NUMBER
);
ALTER TABLE RESERVA_EMPRESA ADD CONSTRAINT PK_RESERVA_EMPRESA_ID PRIMARY KEY (id);
ALTER TABLE RESERVA_EMPRESA ADD CONSTRAINT PK_RESERVA_EMPRESA_ID_JUGUETE FOREIGN KEY (id_juguete) REFERENCES JUGUETE_EMPRESA (id);

-- CARRITO_TEMPORAL_PARTICULAR
CREATE TABLE CARRITO_TEMPORAL_PARTICULAR (
    id NUMBER,
    id_cliente NUMBER,
    id_juguete NUMBER
);
ALTER TABLE CARRITO_TEMPORAL_PARTICULAR ADD CONSTRAINT PK_CARRITO_TEMPORAL_PARTICULAR_ID PRIMARY KEY (id);
ALTER TABLE CARRITO_TEMPORAL_PARTICULAR ADD CONSTRAINT FK_CARRITO_TEMPORAL_PARTICULAR_ID_CLIENTE FOREIGN KEY (id_cliente) REFERENCES CLIENTE (id);
ALTER TABLE CARRITO_TEMPORAL_PARTICULAR ADD CONSTRAINT FK_CARRITO_TEMPORAL_PARTICULAR_ID_JUGUETE FOREIGN KEY (id_juguete) REFERENCES JUGUETE_PARTICULAR (id);

-- CARRITO_TEMPORAL_EMPRESA
CREATE TABLE CARRITO_TEMPORAL_EMPRESA (
    id NUMBER,
    id_cliente NUMBER,
    id_juguete NUMBER
);
ALTER TABLE CARRITO_TEMPORAL_EMPRESA ADD CONSTRAINT PK_CARRITO_TEMPORAL_EMPRESA_ID PRIMARY KEY (id);
ALTER TABLE CARRITO_TEMPORAL_EMPRESA ADD CONSTRAINT FK_CARRITO_TEMPORAL_EMPRESA_ID_CLIENTE FOREIGN KEY (id_cliente) REFERENCES CLIENTE (id);
ALTER TABLE CARRITO_TEMPORAL_EMPRESA ADD CONSTRAINT FK_CARRITO_TEMPORAL_EMPRESA_ID_JUGUETE FOREIGN KEY (id_juguete) REFERENCES JUGUETE_EMPRESA (id);


-- DATA
INSERT INTO COMPANIA (cif, nombre, direccion, telefono) VALUES ('A12345678', 'Google', '1600 Amphitheatre Parkway, Mountain View, CA 94043', '+1 650-253-0000');
INSERT INTO COMPRA_PARTICULAR (id, compania, fecha, firma) VALUES (1, 'A12345678', '2023-10-24', 'firma1');
INSERT INTO PARTICULAR (id, dni, nombre, telefono, direccion) VALUES (1, '12345678A', 'Juan Pérez', '+34 654 321 098', 'Calle Mayor, 123');
INSERT INTO JUGUETE_PARTICULAR (id, id_particular, nombre, stock, precio, coste) VALUES (1, 1, 'Pelota', 10, 5.00, 2.50);
INSERT INTO JUGUETE_PARTICULAR (id, id_particular, nombre, stock, precio, coste) VALUES (2, 2, 'Muñeca', 5, 10.00, 5.00);
INSERT INTO COMPRA_PARTICULAR_JUGUETE (id_compra, id_juguete, unidades) VALUES (1, 1, 2);
INSERT INTO COMPRA_PARTICULAR_JUGUETE (id_compra, id_juguete, unidades) VALUES (2, 2, 1);
INSERT INTO RECEPCION_PARTICULAR (id, id_compra, fecha, estado, incidencia) VALUES (1, 1, '2023-10-24', 'Completo', NULL);
INSERT INTO RECEPCION_PARTICULAR (id, id_compra, fecha, estado, incidencia) VALUES (2, 2, '2023-10-25', 'Incompleto', 'Falta una pieza');
INSERT INTO COMPRA_EMPRESA (id, compania, fecha, firma) VALUES (1, 'A12345678', '2023-10-24', 'firma1');
INSERT INTO COMPRA_EMPRESA (id, compania, fecha, firma) VALUES (2, 'B98765432', '2023-10-25', 'firma2');
INSERT INTO EMPRESA (id, cif, nombre, telefono, web, direccion, responsable) VALUES (1, 'A12345678', 'Google', '+1 650-253-0000', 'https://www.google.com', '1600 Amphitheatre Parkway, Mountain View, CA 94043', 'Sundar Pichai');
INSERT INTO EMPRESA (id, cif, nombre, telefono, web, direccion, responsable) VALUES (2, 'B98765432', 'Microsoft', '+1 425-882-8080', 'https://www.microsoft.com', 'One Microsoft Way, Redmond, WA 98052', 'Satya Nadella');
INSERT INTO JUGUETE_EMPRESA (id, id_empresa, nombre, stock, precio, coste) VALUES (1, 1, 'Pelota', 10, 5.00, 2.50);
INSERT INTO JUGUETE_EMPRESA (id, id_empresa, nombre, stock, precio, coste) VALUES (2, 2, 'Muñeca', 5, 10.00, 5.00);
INSERT INTO COMPRA_EMPRESA_JUGUETE (id_compra, id_juguete, unidades) VALUES (1, 1, 2);
INSERT INTO COMPRA_EMPRESA_JUGUETE (id_compra, id_juguete, unidades) VALUES (2, 2, 1);
INSERT INTO RECEPCION_EMPRESA (id, id_compra, fecha, estado, incidencia) VALUES (1, 1, '2023-10-24', 'Completo', NULL);
INSERT INTO RECEPCION_EMPRESA (id, id_compra, fecha, estado, incidencia) VALUES (2, 2, '2023-10-25', 'Incompleto', 'Falta una pieza');
INSERT INTO CLIENTE (id, dni, nombre, email, usuario, clave) VALUES (1, '12345678A', 'Juan Pérez', 'juanperez@gmail.com', 'juanperez', '123456');
INSERT INTO CLIENTE (id, dni, nombre, email, usuario, clave) VALUES (2, '98765432B', 'María González', 'mariagonzalez@gmail.com', 'mariagonzalez', '654321');
INSERT INTO DIRECCION (id, calle, piso, portal, observaciones) VALUES (1, 'Calle Mayor, 123', 1, 1, 'Piso principal');
INSERT INTO DIRECCION (id, calle, piso, portal, observaciones) VALUES (2, 'Calle Menor, 456', 2, 2, 'Piso segundo');
INSERT INTO DIRECCION_CLIENTE (id_direccion, id_cliente) VALUES (1, 1);
INSERT INTO DIRECCION_CLIENTE (id_direccion, id_cliente) VALUES (2, 2);
INSERT INTO FACTURACION (id, cif, razon_social, telefono, pais) VALUES (1, 'A12345678', 'Google', '+1 650-253-0000', 'España');
INSERT INTO FACTURACION (id, cif, razon_social, telefono, pais) VALUES (2, 'B98765432', 'Microsoft', '+1 425-882-8080', 'España');
INSERT INTO VENTA (id, id_cliente, envio, facturacion, fecha, metodo, comp_envio, tipo_tarjeta, codigo_envio, num_tarjeta, gastos_envio) VALUES (1, 1, 'Tarifa fija', 'A12345678', '2023-10-24', 'Efectivo', 'Correos', 'Visa', '1234-5678-9012-3456', '1234567890123456', '5,00');
INSERT INTO VENTA (id, id_cliente, envio, facturacion, fecha, metodo, comp_envio, tipo_tarjeta, codigo_envio, num_tarjeta, gastos_envio) VALUES (2, 2, 'Entrega en mano', 'B98765432', '2023-10-25', 'Online', 'MRW', 'MasterCard', '1234-5678-9012-3456', '1234567890123456', '10,00');
INSERT INTO DEVOLUCION (id, juguete_id, unidades, fecha) VALUES (1, 1, 1, '2023-10-24');
INSERT INTO DEVOLUCION (id, juguete_id, unidades, fecha) VALUES (2, 2, 2, '2023-10-25');
INSERT INTO FACTURACION (id, id_cliente, razon_social, cif, telefono, pais) VALUES (1, 1, 'Google', 'A12345678', '+1 650-253-0000', 'Spain');
INSERT INTO FACTURACION (id, id_cliente, razon_social, cif, telefono, pais) VALUES (2, 2, 'Microsoft', 'B98765432', '+1 425-882-8080', 'Spain');
INSERT INTO VENTA_JUGUETE_PARTICULAR (id, unidades, id_juguete) VALUES (1, 1, 1);
INSERT INTO VENTA_JUGUETE_PARTICULAR (id, unidades, id_juguete) VALUES (2, 2, 2);
INSERT INTO VENTA_EMPRESA_PARTICULAR (id, unidades, id_juguete) VALUES (1, 1, 1);
INSERT INTO VENTA_EMPRESA_PARTICULAR (id, unidades, id_juguete) VALUES (2, 2, 2);
INSERT INTO RESERVA_PARTICULAR (id, unidades, id_juguete) VALUES (1, 1, 1);
INSERT INTO RESERVA_PARTICULAR (id, unidades, id_juguete) VALUES (2, 2, 2);
INSERT INTO RESERVA_EMPRESA (id, unidades, id_juguete) VALUES (1, 1, 1);
INSERT INTO RESERVA_EMPRESA (id, unidades, id_juguete) VALUES (2, 2, 2);
INSERT INTO CARRITO_TEMPORAL_PARTICULAR (id, id_cliente, id_juguete) VALUES (1, 1, 1);
INSERT INTO CARRITO_TEMPORAL_PARTICULAR (id, id_cliente, id_juguete) VALUES (2, 2, 2);
INSERT INTO CARRITO_TEMPORAL_EMPRESA (id, id_cliente, id_juguete) VALUES (1, 1, 1);
INSERT INTO CARRITO_TEMPORAL_EMPRESA (id, id_cliente, id_juguete) VALUES (2, 2, 2);
